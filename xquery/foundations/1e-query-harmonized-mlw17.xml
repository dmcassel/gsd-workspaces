<export><workspace name="1e-query-harmonized-mlw17"><query name="shipping-zip-cts-query" focus="true" active="true" content-source="as:6240101570028256752:" mode="xquery">xquery version "1.0-ml";
(:
 : Show me any customer records having a shipping-zip equal to 36628
:)


cts:search(
  fn:collection("customer"), 
  cts:element-word-query(xs:QName("shipping-zip"),"36628") 
    )</query><query name="shipping-zip-xpath-query" focus="false" active="true" content-source="as:6240101570028256752:" mode="xquery">xquery version "1.0-ml";
(:
 :Show me any customer records having a shipping-zip equal to 36628
 :
 : Select 
 : From Documents (The database)
 : Where customer.canonical.shipping-zip = 36628
:)

/customer[canonical/shipping-zip eq "36628"]</query><query name="REST-get-query-1" focus="false" active="true" content-source="as:6240101570028256752:" mode="xquery">xquery version "1.0-ml";
(: Search with REST
 :
 : Show me any customer records containing the text 'alabama'
:)
(:
 : Query Related Orders, Products by Key
 : Add Triples to Envelope
 : Query Related Orders by Triple
 : Addional Metadata to relationships 
:)

xdmp:http-get(fn:concat("http://localhost:8000/v1/search?q=alabama"), 
                   &lt;options xmlns="xdmp:http"&gt;
                    &lt;authentication&gt;
                       &lt;username&gt;admin&lt;/username&gt;
                       &lt;password&gt;admin&lt;/password&gt;
                    &lt;/authentication&gt;
                   &lt;/options&gt;)
 
  
(: Change alabama to 36628, then texas, view results :)</query><query name="REST-post-structured-query-2" focus="false" active="true" content-source="as:6240101570028256752:" mode="xquery">xquery version "1.0-ml";
(:
   Structured Search with REST
:)
let $structured-query :=
'{
    "query" : {
      "queries": [{
          "value-query" : {
              "element": {
                "name": "shipping-zip",
                "ns": ""
              },
                "text": [
                  "36628"
                ]
           }
      }]
    }
 }'
 
return 
xdmp:http-post(fn:concat("http://localhost:8000/v1/search"), 
                   &lt;options xmlns="xdmp:http"&gt;
                    &lt;authentication&gt;
                       &lt;username&gt;admin&lt;/username&gt;
                       &lt;password&gt;admin&lt;/password&gt;
                    &lt;/authentication&gt;
                      &lt;headers&gt;
                       &lt;content-type&gt;application/json&lt;/content-type&gt;
                    &lt;/headers&gt;
                   &lt;/options&gt;,
                   document{ $structured-query }
                )(: [2] :)</query><query name="REST-get-document" focus="false" active="true" content-source="as:6240101570028256752:" mode="xquery">xquery version "1.0-ml";
(:
   Return a document/entity with REST
:)

xdmp:http-get(fn:concat("http://localhost:8000/v1/documents?uri=/denormalized/customer-1.xml"), 
                   &lt;options xmlns="xdmp:http"&gt;
                    &lt;authentication&gt;
                       &lt;username&gt;admin&lt;/username&gt;
                       &lt;password&gt;admin&lt;/password&gt;
                    &lt;/authentication&gt;
                   &lt;/options&gt;)</query><query name="orders-by-key" focus="false" active="true" content-source="as:6240101570028256752:" mode="xquery">xquery version "1.0-ml";
(:
Show me the Orders related to a particular Customer
:)
let $customer-doc := fn:doc("/denormalized/customer-3.xml")
let $customer-id := $customer-doc/customer/source/customer_id
let $orders := fn:collection("order")/order[customer_id eq $customer-id]
return ($customer-doc, $orders )</query><query name="products-by-key" focus="false" active="true" content-source="as:6240101570028256752:" mode="xquery">xquery version "1.0-ml";
(:
Show me the Products related to the Orders for a particular Customer
:)

let $customer-doc := fn:doc("/denormalized/customer-3.xml")
let $customer-id := $customer-doc/customer/source/customer_id

let $orders := fn:collection("order")/order[customer_id eq $customer-id]
let $prod-ids := fn:distinct-values($orders/order_lines/order_line/product/text())

let $products := fn:collection("product")/product[id eq $prod-ids]
return $products/(&lt;prod&gt;{name, sku}&lt;/prod&gt;)</query></workspace></export>
