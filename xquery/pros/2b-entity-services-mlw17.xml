<export><workspace name="2b-entity-services-mlw17"><query name="Four-view join" focus="false" listorder="6" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="sql">SELECT * from 
ECommerce.Order l,
ECommerce.Order_orderLines ol,
ECommerce.Customer c,
ECommerce.Product p
WHERE l.customer = c.id
and c.firstName like 'B%'
AND ol.id = l.id
ORDER BY c.id</query><query name="Model Query" focus="false" listorder="7" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="sparql"># the model is surfaced to MarkLogic as a graph.
# you can query for properties of a model with SPARQL.
PREFIX es: &lt;http://marklogic.com/entity-services#&gt;

SELECT ?s ?p ?o WHERE { 
  ?s a es:Model ;
#      ?p ?o
}
</query><query name="Type Query" focus="false" listorder="8" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="sparql"># All aspects of model descriptors are surfaced as
# triples.
PREFIX es: &lt;http://marklogic.com/entity-services#&gt;

SELECT ?s ?p ?o
WHERE { 
  ?s a es:EntityType ;
#      ?p ?o
}
</query><query name="Intro" focus="true" listorder="1" taborder="1" active="true" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="xquery">(:

This workspace provides the basics of querying instance data created with 
Entity Services.

You'll see how MarkLogic search built-ins can display index values,
how SQL and SPARQL can query instance and model data, and how
basic Optic API queries can help you navigate your models and instances.

:)</query><query name="Customers" focus="false" listorder="4" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="sql">SELECT * from 
ECommerce.Customer c
WHERE c.firstName like 'N%'
ORDER BY c.id
</query><query name="Addresses" focus="false" listorder="6" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="sql">SELECT billTo, shipTo from ECommerce.Customer</query><query name="Instance Query" focus="false" listorder="10" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="sparql"># generated extraction templates put instance data into classes
PREFIX es: &lt;http://marklogic.com/entity-services#&gt; 
PREFIX ecommerce: &lt;http://marklogic.com/example/ontology/ECommerce-0.0.1/&gt; 

SELECT ?s ?type
WHERE { 
   ?s a ?type .
   ?type a es:EntityType .
#   ?p ?o .  
}
</query><query name="Doc Retrieval" focus="false" listorder="11" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="sparql"># SPARQL queries can use built-in functions.
# This one reads the instance document
PREFIX es: &lt;http://marklogic.com/entity-services#&gt;
PREFIX fn: &lt;http://www.w3.org/2005/xpath-functions#&gt;
PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
PREFIX cts: &lt;http://marklogic.com/cts#&gt;

SELECT ?doc
WHERE { 
  ?s rdfs:isDefinedBy ?o .
  FILTER (cts:contains(?doc, "Wheeler"))
  BIND (fn:doc(?o) as ?doc) 
}</query><query name="Property Query" focus="false" listorder="9" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="sparql"># use the es:title property to get user-readable labels to
# your report or application
PREFIX es: &lt;http://marklogic.com/entity-services#&gt;

SELECT ?s ?propertyLabel ?typeLabel
WHERE 
{ 
  ?s a es:Property ;
       es:title ?propertyLabel
#      ?p ?o 
  .
  ?type es:property ?s ;
       es:title ?typeLabel
}</query><query name="Optic Model" focus="false" listorder="12" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="xquery">(: An Optic query can also query the triples in an Entity Services Model :)
import module namespace op = "http://marklogic.com/optic" at "/MarkLogic/optic.xqy";

let $es := op:prefixer("http://marklogic.com/entity-services#")
let $rdf := op:prefixer("http://www.w3.org/1999/02/22-rdf-syntax-ns#")

return
op:from-triples( (
   op:pattern( op:col("s"), $rdf("type"), $es("Model") ),
   op:pattern( op:col("s"), op:col("p"), op:col("o") )
   ) )
=&gt;op:result()</query><query name="Optic Type" focus="false" listorder="13" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="xquery">import module namespace op = "http://marklogic.com/optic" at "/MarkLogic/optic.xqy";

let $es := op:prefixer("http://marklogic.com/entity-services#")
let $rdf := op:prefixer("http://www.w3.org/1999/02/22-rdf-syntax-ns#")

return
op:from-triples( (
   op:pattern( op:col("s"), $rdf("type"), $es("EntityType") ),
   op:pattern( op:col("s"), op:col("p"), op:col("o") )
   ) )
=&gt;op:result()</query><query name="Optic Property" focus="false" listorder="14" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="xquery">import module namespace op = "http://marklogic.com/optic" at "/MarkLogic/optic.xqy";

let $es := op:prefixer("http://marklogic.com/entity-services#")
let $rdf := op:prefixer("http://www.w3.org/1999/02/22-rdf-syntax-ns#")

return
op:from-triples( (
   op:pattern( op:col("s"), $rdf("type"), $es("Property") ),
   op:pattern( op:col("s"), $es("title"), op:col("propertyLabel")),
   op:pattern( op:col("t"), $es("property"), op:col("s")),
   op:pattern( op:col("t"), $es("title"), op:col("typeLabel"))
   ) )
=&gt;op:select( ("typeLabel", "propertyLabel") )   
=&gt;op:result()</query><query name="Optic Documents" focus="false" listorder="15" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="xquery">(: Optic results can be processed without a binding/retrieval process :)
import module namespace op = "http://marklogic.com/optic" at "/MarkLogic/optic.xqy";
import module namespace es = "http://marklogic.com/entity-services" at "/MarkLogic/entity-services/entity-services.xqy";

let $es := op:prefixer("http://marklogic.com/entity-services#")
let $rdf := op:prefixer("http://www.w3.org/1999/02/22-rdf-syntax-ns#")
let $fn := op:prefixer("http://www.w3.org/2005/xpath-functions#")
let $rdfs := op:prefixer("http://www.w3.org/2000/01/rdf-schema#")
let $cts := op:prefixer("http://marklogic.com/cts#")
let $result := 
 op:from-triples( (
   op:pattern( op:col("s"), $rdfs("isDefinedBy"), op:col("doc") )
   ) )=&gt;op:select("doc")=&gt;op:result()

return $result ! fn:doc(map:get(., "doc"))//firstName
</query><query name="Lexicons" focus="false" listorder="2" taborder="0" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="xquery">declare function local:idx-values($path-range-index) {
cts:values(
  cts:path-reference(
    $path-range-index, 
    (), 
    map:entry("es", "http://marklogic.com/entity-services")))
};

(: All the values in the Order/orderDate property (xs:date)
"All of the order dates:", local:idx-values("//es:instance/Order/orderDate")
:)

(: All the values in the Order/shipDate property (xs:dateTime)
"All of the ship dates:", local:idx-values("//es:instance/Order/shipDate")
:)

(: All the values in the OrderLine/total property
"All the total values from order lines:" , local:idx-values("//es:instance/Order/orderLines/OrderLine/total")
:)</query><query name="Aggregates" focus="false" listorder="3" taborder="" active="false" database="369696519400586114" server="3092011375014892023" database-name="Documents" server-name="App-Services" mode="xquery">declare function local:sum($path-range-index) {
cts:sum-aggregate(
  cts:path-reference(
    $path-range-index, 
    (), 
    map:entry("es", "http://marklogic.com/entity-services")))
};

("Sum of all the total values from orders:",
local:sum("//es:instance/Order/orderLines/OrderLine/total")
)</query></workspace></export>
